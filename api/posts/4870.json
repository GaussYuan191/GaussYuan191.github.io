{"title":"第一周学习总结","slug":"第一周学习总结","date":"2022-01-03","updated":"2022-01-03","comments":true,"path":"api/posts/4870.json","excerpt":null,"cover":null,"covers":null,"content":"<a id=\"more\"></a><h1 id=\"promise\"><a class=\"headerlink\" href=\"#promise\"></a>promise</h1><h2 id=\"手写 promise\"><a class=\"headerlink\" href=\"# 手写 promise\"></a> 手写 promise</h2><p><strong>es5 版（简化版）</strong></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> pending = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> fulfilled = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> reject = <span class=\"string\">'reject'</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyPromise</span> (<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 保存 this</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 保存初始化状态 </span></span><br><span class=\"line\">    self.state = pending;</span><br><span class=\"line\">    <span class=\"comment\">// 初始化 value resolve</span></span><br><span class=\"line\">    self.value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 初始化 reason reject</span></span><br><span class=\"line\">    self.reason = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 保存 resolve 的回调函数 </span></span><br><span class=\"line\">    self.resolvedCallbacks = [];</span><br><span class=\"line\">    <span class=\"comment\">// 保存 reject 的回调函数 </span></span><br><span class=\"line\">    self.rejectedCallbacks = [];</span><br><span class=\"line\">    <span class=\"comment\">// resolve 方法 </span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"comment\">// 判断传入的元素是否为 promise 值，如果是，则状态改变必须等前一个状态改变后再进行改变 </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (value <span class=\"keyword\">instanceof</span> MyPromise) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> value.then(resolve, reject);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 保证代码的执行顺序为本轮时间循环的末尾 </span></span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (self.state === pending) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 改变状态 </span></span><br><span class=\"line\">                self.state = fulfilled;</span><br><span class=\"line\">                <span class=\"comment\">// 传入值 </span></span><br><span class=\"line\">                self.value = value;</span><br><span class=\"line\">                <span class=\"comment\">// 执行回调函数 </span></span><br><span class=\"line\">                self.resolvedCallbacks.forEach(<span class=\"function\"><span class=\"params\">callback</span> =&gt;</span> callback (value));</span><br><span class=\"line\">                </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","url":"/posts/4870/","min2read":"1","word4post":184,"prev_post":{"title":"antd 中 Table 的 dataSource 不更新？？","url":"/posts/34168/"},"next_post":{"title":"2021 年终总结","url":"/posts/8569/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"promise\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">promise</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" data-id=\"手写 promise\" href = \"#\"><span class=\"toc-number\">1.1.</span> <span class=\"toc-text\"> 手写 promise</span></a></li></ol></li></ol>","categories":[{"name":"小结","path":"api/categories/小结.json","url":"/categories/小结/"}],"tags":[{"name":"promise","path":"api/tags/promise.json","url":"/tags/promise/"},{"name":"浏览器的缓存机制","path":"api/tags/浏览器的缓存机制.json","url":"/tags/浏览器的缓存机制/"},{"name":"浏览器安全","path":"api/tags/浏览器安全.json","url":"/tags/浏览器安全/"},{"name":"http","path":"api/tags/http.json","url":"/tags/http/"},{"name":"工具函数","path":"api/tags/工具函数.json","url":"/tags/工具函数/"},{"name":"设计模式","path":"api/tags/设计模式.json","url":"/tags/设计模式/"}]}