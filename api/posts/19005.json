{"title":"常见的功能函数","slug":"常见的功能函数","date":"2022-02-16","updated":"2022-02-16","comments":true,"path":"api/posts/19005.json","excerpt":"<p></p>","cover":"/gallery/js-2022-2-16.jpeg","covers":["/gallery/js-2022-2-16.jpeg"],"content":"<p><img src=\"/gallery/js-2022-2-16.jpeg\" alt=\"\"></p><a id=\"more\"></a><h1 id=\" 对象扁平化 \"><a class=\"headerlink\"href=\"# 对象扁平化 \"></a>对象扁平化 </h1><p> 主要是通过递归，使嵌套的数据扁平 </p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建判断对象的函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isObject</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.prototype.toString.call(obj).slice(<span class=\"number\">8</span>, <span class=\"number\">-1</span>) === <span class=\"string\">'Object'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">flatObject</span> (<span class=\"params\">obj, pre = <span class=\"string\">''</span>, res = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!obj) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"built_in\">Reflect</span>.ownKeys(obj).forEach(<span class=\"function\">(<span class=\"params\">key</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> perKey = pre + key;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isObject(obj[key])) &#123;</span><br><span class=\"line\">            flatObject(obj[key], perKey + <span class=\"string\">'.'</span>, res);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            res[perKey] = obj[key];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"数组偏平化\"><a class=\"headerlink\" href=\"# 数组偏平化\"></a> 数组偏平化 </h1><p>let arr = [[1, 2, 3],[1,3,[4]],3];</p><p><strong>1.Array.flat</strong></p><p>flat 默认只会拉平一层,Infinity, 全拉平</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arr.flat(<span class=\"literal\">Infinity</span>) <span class=\"comment\">// [1, 2, 3, 1, 3, 4, 3]</span></span><br></pre></td></tr></table></figure><p><strong>2.reduce</strong></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> flat_reduce = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.reduce(<span class=\"function\">(<span class=\"params\">pre, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Array</span>.isArray(cur) ? pre.concat(flat_reduce(cur)) : pre.concat(cur)</span><br><span class=\"line\">  &#125;, [])</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">flat_reduce(arr1)</span><br></pre></td></tr></table></figure><p><strong>3.forEach()</strong></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> flat_forEach = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> ans = [];</span><br><span class=\"line\">  arr.forEach(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Array</span>.isArray(item) ? ans = ans.concat(flat_forEach(item)) : ans.push(item);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p><strong>4.toString()</strong></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> flat_toString = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.toString().split(<span class=\"string\">','</span>).map(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> <span class=\"built_in\">Number</span>(item))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">flat_toString(arr)</span><br></pre></td></tr></table></figure><p><strong>5.join(),split()</strong></p><p> 和 toString 的方法相同 </p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> flat_join = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.join(<span class=\"string\">','</span>).split(<span class=\"string\">','</span>).map(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> <span class=\"built_in\">Number</span>(item))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">flat_join(arr)</span><br></pre></td></tr></table></figure><p><strong>6. 拓展运算符</strong></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> flat_ = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 判断数组中是否包含对象 some</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (arr.some(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> <span class=\"built_in\">Array</span>.isArray(item))) &#123;</span><br><span class=\"line\">    arr = [].concat(...arr)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">flat_(arr)</span><br></pre></td></tr></table></figure><h1 id=\"扁平化数据结构转 Tree\"><a class=\"headerlink\" href=\"# 扁平化数据结构转 Tree\"></a> 扁平化数据结构转 Tree</h1><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> arr = [</span><br><span class=\"line\">  &#123; <span class=\"attr\">id</span>: <span class=\"number\">1</span>, <span class=\"attr\">name</span>: <span class=\"string\">\"部门 1\"</span>, <span class=\"attr\">pid</span>: <span class=\"number\">0</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">id</span>: <span class=\"number\">2</span>, <span class=\"attr\">name</span>: <span class=\"string\">\"部门 2\"</span>, <span class=\"attr\">pid</span>: <span class=\"number\">1</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">id</span>: <span class=\"number\">3</span>, <span class=\"attr\">name</span>: <span class=\"string\">\"部门 3\"</span>, <span class=\"attr\">pid</span>: <span class=\"number\">1</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">id</span>: <span class=\"number\">4</span>, <span class=\"attr\">name</span>: <span class=\"string\">\"部门 4\"</span>, <span class=\"attr\">pid</span>: <span class=\"number\">3</span> &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">id</span>: <span class=\"number\">5</span>, <span class=\"attr\">name</span>: <span class=\"string\">\"部门 5\"</span>, <span class=\"attr\">pid</span>: <span class=\"number\">4</span> &#125;,</span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure><p><strong>1. 递归 </strong></p><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function arrayToTree(arr, pid) &#123;</span><br><span class=\"line\">  let result &#x3D; [];</span><br><span class=\"line\">  getChildren(arr, result, pid);</span><br><span class=\"line\">  return result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">const getChildren &#x3D; (data, result, pid) &#x3D;&gt; &#123;</span><br><span class=\"line\">  data.forEach(item &#x3D;&gt; &#123;</span><br><span class=\"line\">    if (item.pid &#x3D;&#x3D;&#x3D; pid) &#123;</span><br><span class=\"line\">      let newItem &#x3D; &#123;...item, children:[]&#125;;</span><br><span class=\"line\">      result.push(newItem);</span><br><span class=\"line\">      &#x2F;&#x2F; 递归</span><br><span class=\"line\">      getChildren(data, newItem.children, item.pid)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><p><strong>2. 迭代</strong></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">arrayToTree</span>(<span class=\"params\">arr, pid</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 先把数据变成 map 格式</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> map = <span class=\"keyword\">new</span> <span class=\"built_in\">Map</span>();</span><br><span class=\"line\">  arr.forEach(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> newNode = &#123; ...item, <span class=\"attr\">children</span>: [] &#125;;</span><br><span class=\"line\">    map.set(item.id, newNode</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = [];</span><br><span class=\"line\">  arr.forEach(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> id = item.id;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> itemPid = item.pid;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> treeItem = map.get(id);</span><br><span class=\"line\">    <span class=\"comment\">// 找到根节点</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (itemPid === pid) &#123;</span><br><span class=\"line\">      res.push(treeItem);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      map.get(itemPid).children.push(treeItem);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"数组去重\"><a class=\"headerlink\" href=\"# 数组去重\"></a> 数组去重 </h1><p>let arr = [1, 2, 3, 3, 2, 4, 2, 7, 5, 9];</p><p><strong>1.Set</strong></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> deDuplication_set = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Array</span>.from(<span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>(arr));</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><p><strong>2. 利用对象</strong></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> deDuplication_object = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> obj = &#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = [];</span><br><span class=\"line\">  arr.forEach(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!obj[item]) &#123;</span><br><span class=\"line\">      res.push(item);</span><br><span class=\"line\">      obj[item] = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><p><strong>3. 利用 map</strong></p><p> 如果 map 中不存在，就放在 map 中，最后取 map 的 keys</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> deDuplication_map = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> map = <span class=\"keyword\">new</span> <span class=\"built_in\">Map</span>();</span><br><span class=\"line\">  arr.forEach(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!map.has(item)) &#123;</span><br><span class=\"line\">      map.set(item, <span class=\"literal\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Array</span>.from(map.keys());</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><p><strong>4.filter indexOf</strong></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> deDuplication_filter = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.filter(<span class=\"function\">(<span class=\"params\">item, index, arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr.indexOf(item) == index;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><p><strong>5. 新建数组 + sort</strong></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> deDuplication_sort = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  arr.sort(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a - b);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> res = [arr[<span class=\"number\">0</span>]];</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (arr[i] !== arr[i - <span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">      res.push(arr[i]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><p><strong>6.reduce + includes</strong></p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> deDuplication_reduce = <span class=\"function\">(<span class=\"params\">arr</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.reduce(<span class=\"function\">(<span class=\"params\">pre, cur</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pre.includes(cur) === <span class=\"number\">-1</span> ? [...pre, cur] : pre;</span><br><span class=\"line\">  &#125;, []);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><h1 id=\"防抖\"><a class=\"headerlink\" href=\"# 防抖\"></a>防抖 </h1><p> 场景：输入框输入搜索的时候 </p><p> 效果：输入的时间间隔大于规定的时间间隔，执行相关的功能函数 </p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 第一次不执行</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">debounce</span>(<span class=\"params\">fn, ms</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> timer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">..args</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (timer) &#123;</span><br><span class=\"line\">            clearTimeout(timer);</span><br><span class=\"line\">        &#125;  <span class=\"comment\">// 如果在一段时间频繁触发，之前的定时器就会被清空</span></span><br><span class=\"line\">        timer = setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">            fn.apply(<span class=\"keyword\">this</span>, args)</span><br><span class=\"line\">        &#125;, time)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 第一次执行</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">debounce</span>(<span class=\"params\">fn, ms</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> timer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> flag = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> funciton(...args) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (timer) &#123;</span><br><span class=\"line\">            clearTimeout(timer);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (flag &amp;&amp; !timer) &#123;</span><br><span class=\"line\">            fn.apply(<span class=\"keyword\">this</span>, args);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        timer = setTimeout(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span> &#123;</span><br><span class=\"line\">            fn.apply(<span class=\"keyword\">this</span>, args);</span><br><span class=\"line\">        &#125;, ms);</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"节流\"><a class=\"headerlink\" href=\"# 节流\"></a> 节流 </h1><p> 场景：下拉框滑动时 </p><p> 效果：一段时间函数只执行一次，高频事件会稀释函数 </p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 基于闭包</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">throttle</span>(<span class=\"params\">fn, ms</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> timer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">..args</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!timer) &#123;</span><br><span class=\"line\">            timer = setTimeout(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span> &#123;</span><br><span class=\"line\">                fn.apply(<span class=\"keyword\">this</span>, args);</span><br><span class=\"line\">                timer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            &#125;, ms);</span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 基于时间戳</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">throllte</span>(<span class=\"params\">fn, ms</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> pre = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">...args</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> now = <span class=\"built_in\">Date</span>.now();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (now - pre &gt; ms) &#123;</span><br><span class=\"line\">            fn.apply(<span class=\"keyword\">this</span>, args);</span><br><span class=\"line\">            pre = now;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"call、apply、bind\"><a class=\"headerlink\" href=\"#call、apply、bind\"></a>call、apply、bind</h1><p>this 的绑定规则， 分为以下四种：</p><p>1. 默认绑定</p><p>​ 默认情况下，this 指向全局对象，不过在严格模式下，this 无法指向全局对象，this 会绑定到 undefined</p><p>2. 隐式绑定</p><p>​ 当函数作为方法被调用，需考虑运行时上下文环境</p><p>3. 显示绑定</p><p>​ call、apply、bind</p><p>4.new 绑定</p><p>​ 如果使用 new 构造函数，在函数的内部，this 会指向新构造的函数</p><p><strong>call</strong></p><p> 核心：就是把函数挂载到 obj 上，执行 obj.f()的时候，f 中的 this 就指向 obj，执行完后删除挂载在 obj 上的函数 f</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myCall = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">thisArg, ...args</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 判断挂载的是不是函数 </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span> != <span class=\"string\">\"function\"</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">\"The caller must be a fucntion\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 没有传入对象, 就挂载在全局对象上</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (thisArg === <span class=\"literal\">undefined</span> || thisArg === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        thisArg = globalThis;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 将参数转成对象</span></span><br><span class=\"line\">        thisArg = <span class=\"built_in\">Object</span>(thisArg);</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 把函数挂载到对象上， this 指向被调用的函数</span></span><br><span class=\"line\">    thisArg.fn = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 执行该函数</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> res = thisArg.fn(...args);</span><br><span class=\"line\">    <span class=\"comment\">// 删除挂载的函数</span></span><br><span class=\"line\">    <span class=\"keyword\">delete</span> thisArg.fn;</span><br><span class=\"line\">    <span class=\"comment\">// 返回结果</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p><strong>apply</strong></p><p> 核心：同 call，但是 apply 传的参数是数组 </p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myApply = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">thisArg, args = []</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 判断挂载的是不是函数</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span> != <span class=\"string\">\"function\"</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">\"apply must be a fucntion\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (thisArg === <span class=\"literal\">undefined</span> || thisArg === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        thisArg = globalThis;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        thisArg = <span class=\"built_in\">Object</span>(thisArg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 判断参数是不是数组</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!<span class=\"built_in\">Array</span>.isArray(args)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">\"second argument to Fucntion.prototype.apply argument must be an array\"</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    thisArg.fn = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> res = thisArg.fn(...args);</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> thisArg.fn;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p><strong>bind</strong></p><p> 核心：但是 bind 返回的是一个函数，且 this 的指向已经改变，之后不会发生变化。</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myBind = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">thisArg, ...args1</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span> != <span class=\"string\">\"function\"</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">\"the caller must be a funciton\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> fnBind = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnBound</span>(<span class=\"params\">...args2</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 如果是通过 new 调用的</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span> <span class=\"keyword\">instanceof</span> fnBound) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> fnBound(...args1, ...args2)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> fnBind.apply(<span class=\"keyword\">this</span>, [...args1, ...args2]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","url":"/posts/19005/","min2read":7,"word4post":"1.4k","prev_post":{"title":"this 指向问题总结","url":"/posts/1313/"},"next_post":{"title":"Reflect 对象解析","url":"/posts/60673/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\" 对象扁平化 \" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">对象扁平化 </span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"数组偏平化\" href = \"#\"><span class=\"toc-number\">2.</span> <span class=\"toc-text\"> 数组偏平化 </span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"扁平化数据结构转 Tree\" href = \"#\"><span class=\"toc-number\">3.</span> <span class=\"toc-text\"> 扁平化数据结构转 Tree</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"数组去重\" href = \"#\"><span class=\"toc-number\">4.</span> <span class=\"toc-text\"> 数组去重 </span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"防抖\" href = \"#\"><span class=\"toc-number\">5.</span> <span class=\"toc-text\">防抖 </span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"节流\" href = \"#\"><span class=\"toc-number\">6.</span> <span class=\"toc-text\"> 节流 </span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"call、apply、bind\" href = \"#\"><span class=\"toc-number\">7.</span> <span class=\"toc-text\">call、apply、bind</span></a></li></ol>","categories":[{"name":"功能函数","path":"api/categories/功能函数.json","url":"/categories/功能函数/"}],"tags":[{"name":"js","path":"api/tags/js.json","url":"/tags/js/"}]}