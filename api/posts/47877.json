{"title":"node.js 搭建服务器","slug":"初识node-js","date":"2021-03-27","updated":"2021-03-27","comments":true,"path":"api/posts/47877.json","excerpt":"<h1 id=\"Nodejs 搭建服务器及 express 编写接口\"><a class=\"headerlink\" href=\"#Nodejs 搭建服务器及 express 编写接口\"></a>Nodejs 搭建服务器及 express 编写接口 </h1>","cover":"/gallery/node-http-server.png","covers":["/gallery/node-http-server.png"],"content":"<h1 id=\"Nodejs 搭建服务器及 express 编写接口\"><a class=\"headerlink\" href=\"#Nodejs 搭建服务器及 express 编写接口\"></a>Nodejs 搭建服务器及 express 编写接口 </h1><a id=\"more\"></a><p>Nodejs 用 http 模块搭建 http 服务器：</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 引入 http 模块</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">\"http\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">'url'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 设置主机名</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> hostName = <span class=\"string\">'192.168.1.7'</span>;</span><br><span class=\"line\"><span class=\"comment\">// 设置端口</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> port = <span class=\"number\">8092</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">// 创建服务</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> server = http.createServer(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> string = url.parse(req.url, <span class=\"literal\">true</span>);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"URL:\"</span> + req.url + <span class=\"string\">\"\"</span> + string.pathname);</span><br><span class=\"line\">    res.setHeader(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">\"*\"</span>)</span><br><span class=\"line\">    res.setHeader(<span class=\"string\">\"Access-Control-Allow-Headers\"</span>, <span class=\"string\">\"Origin, X-Requested-With, Content-Type, Accept\"</span>);</span><br><span class=\"line\">    res.setHeader(<span class=\"string\">'Content-Type'</span>, <span class=\"string\">'text/plain'</span>);</span><br><span class=\"line\">    res.end(<span class=\"string\">\"hello nodejs\"</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">server.listen(port, hostName, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">` 服务器运行在 http://<span class=\"subst\">$&#123;hostName&#125;</span>:<span class=\"subst\">$&#123;port&#125;</span>`</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure><p> 效果如图所示 </p><p><img src=\"/gallery/node-http-server.png\"alt=\"\"></p><p> 用 Nodejs 的 express 搭建 http 服务器：</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>)</span><br><span class=\"line\"><span class=\"keyword\">var</span> bodyParser = <span class=\"built_in\">require</span>(<span class=\"string\">'body-parser'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 设置主机名 </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> hostName = <span class=\"string\">'192.168.1.7'</span>;<span class=\"comment\">//172.50.4.113  192.168.1.130</span></span><br><span class=\"line\"><span class=\"comment\">// 设置端口</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> port = <span class=\"number\">8092</span>;<span class=\"comment\">//8086</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> app = express();</span><br><span class=\"line\"><span class=\"keyword\">var</span> routes = express.Router();</span><br><span class=\"line\"><span class=\"comment\">// 设置路由访问路径和静态资源目录</span></span><br><span class=\"line\">app.use(<span class=\"string\">\"/a\"</span>, express.static(<span class=\"string\">'public'</span>))</span><br><span class=\"line\">app.use(<span class=\"string\">\"/a\"</span>, routes);</span><br><span class=\"line\"><span class=\"comment\">// app.use(express.static('./'));</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> server = app.listen(port, hostName, (err) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(err)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">` 服务开启成功【端口号:<span class=\"subst\">$&#123;port&#125;</span>】`</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure><p> 用 express 搭建 GET 请求接口：</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * express 建立 GET 接口 </span></span><br><span class=\"line\"><span class=\"comment\"> * http://192.168.1.7:8092/a/ab?name='name12'&amp;pwd='123'</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">routes.get(<span class=\"string\">'/ab'</span>, (req, res) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> string = url.parse(req.url, <span class=\"literal\">true</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 解析参数</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> params = url.parse(req.url, <span class=\"literal\">true</span>).query;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(params)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> user = &#123;&#125;;</span><br><span class=\"line\">    user.name = params.name;</span><br><span class=\"line\">    user.pwd = params.pwd;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> responseJson = &#123; <span class=\"attr\">name</span>: <span class=\"string\">'abc'</span>, <span class=\"attr\">pwd</span>: <span class=\"string\">'123'</span> &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> response = &#123; <span class=\"attr\">status</span>: <span class=\"number\">2</span>, <span class=\"attr\">data</span>: user &#125;;</span><br><span class=\"line\">    res.send(<span class=\"built_in\">JSON</span>.stringify(response));</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"URL:\"</span> + req.url + <span class=\"string\">\"\"</span> + string.pathname);</span><br><span class=\"line\">    res.status(<span class=\"number\">200</span>).json(response);</span><br><span class=\"line\">    <span class=\"comment\">// 有数据返回用 res.send();</span></span><br><span class=\"line\">    <span class=\"comment\">// 无数据返回用 res.end();</span></span><br><span class=\"line\">    <span class=\"comment\">// res.end(\"hello nodejs\");</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure><p> 用 express 搭建 POST 请求接口：</p><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * express 建立 POST 接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">routes.post(<span class=\"string\">'/r'</span>, (req, res) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> string = url.parse(req.url, <span class=\"literal\">true</span>);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"URL:\"</span> + req.url + <span class=\"string\">\"  \"</span> + string.pathname);</span><br><span class=\"line\">    <span class=\"comment\">// 解析参数</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> params = req.body;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> user = &#123;&#125;;</span><br><span class=\"line\">    user.name = params.name;</span><br><span class=\"line\">    user.pwd = params.pwd;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> response = &#123; <span class=\"attr\">status</span>: <span class=\"number\">1</span>, <span class=\"attr\">data</span>: user &#125;;</span><br><span class=\"line\">    res.send(<span class=\"built_in\">JSON</span>.stringify(response));</span><br><span class=\"line\">    res.send(<span class=\"string\">'post:'</span> + string.pathname + <span class=\"string\">\"  \"</span> +</span><br><span class=\"line\">        <span class=\"built_in\">JSON</span>.stringify(text));</span><br><span class=\"line\">    res.end();</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(req.method);<span class=\"comment\">//post</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(req.body);<span class=\"comment\">//&#123; a:'3', b:'4', c:'5'&#125;</span></span><br><span class=\"line\">    <span class=\"comment\">// console.log(req.body.a); //3</span></span><br><span class=\"line\">    <span class=\"comment\">// res.end(\"hello nodejs\");</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>","url":"/posts/47877/","min2read":2,"word4post":486,"prev_post":{"title":"HTTP 是什么？","url":"/posts/8716/"},"next_post":{"title":"Vue 知识点小结","url":"/posts/53151/"},"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" data-id=\"Nodejs 搭建服务器及 express 编写接口\" href = \"#\"><span class=\"toc-number\">1.</span> <span class=\"toc-text\">Nodejs 搭建服务器及 express 编写接口 </span></a></li></ol>","categories":[{"name":"node.js","path":"api/categories/node.js.json","url":"/categories/node-js/"}],"tags":[{"name":"搭建服务器","path":"api/tags/搭建服务器.json","url":"/tags/搭建服务器/"}]}